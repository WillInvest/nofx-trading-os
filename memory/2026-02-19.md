# 2026-02-19

## Arena System - First Full Day Running

### What Worked
- Arena hourly cron ran successfully - debates with real bull vs bear tension
- Judge prompt updated to v2 (data verification step)
- BTC LONG from $66,390 â†’ ~$67,096 (+5.2%)
- Frontend rebuilt: sidebar â†’ dropdown, added Prompts tab

### Issues Found (TO FIX NEXT SESSION)
1. **Prompts tab shows nothing** â€” The ðŸ§  Prompts tab was added but prompts aren't displaying. Likely the `api.getArenaPrompts` endpoint returns empty or the `prompt` field name doesn't match what backend sends. Need to debug: check API response vs frontend type `ArenaPrompt`.

2. **Data caching needed** â€” Market data (klines, OI, funding) gets fetched fresh every debate round. User wants data persisted so:
   - Short-term trader can reuse recent data without re-fetching
   - Debate rounds within same session share data
   - Idea: Store fetched data in DB or cache with TTL, keyed by coin+timeframe+timestamp

3. **Debate coin confusion** â€” Arguments discuss ETH but verdict/flag is about BTC. Root cause: debate covers multiple coins (top 30 from hyperliquid source) but judge mixes up which data belongs to which coin. Judge v2 prompt should help but need to verify.

4. **Judge confused ETH RSI with BTC RSI** â€” Called wrong short on BTC using ETH's overbought RSI 75.59. Judge prompt v2 now forces per-coin data verification.

### Cron Jobs Status
- ALL DISABLED to save usage:
  - `fb35f200` - Hourly Review (was working)
  - `3c8319d3` - Daily Review
  - `2694ed5c` - Weekly Review  
  - `bd710cbb` - Monthly Retrospective
  - `676dc909` - TradingAgents (US stock, project closed)

### Frontend Changes
- Sidebar replaced with dropdown selector (saves space)
- Added ðŸ§  Prompts tab to show role prompts from `arena_prompts` table
- Built as `nofx-frontend-observability:v5`

### Account
- $26.83 equity, no positions currently

### Major Improvements Made Today
1. **Prompts tab fixed** â€” API wrapper mismatch (`{prompts:[...]}` vs raw array)
2. **Market data cache** â€” 3min TTL for 5m data, 15min for 1h+ data
3. **Bull prompt restored** â€” Was "Updated bull prompt" (19 chars), now proper 1.3K
4. **OI filter fixed** â€” All 20 Hyperliquid coins were being filtered out (0 OI from Binance source)
5. **Strategy locked to BTC only** â€” Static coin source with just BTCUSDT
6. **DeepSeek R1 as judge** â€” Debate engine auto-initializes R1 for judge phase
7. **SL/TP display fixed** â€” formatSLTP handles both dollar prices and percentages
8. **Sessions dropdown** â€” Sidebar replaced with compact dropdown, auto-selects latest
9. **Thousand separator fix** â€” Auto-sanitizes "6,890" â†’ "6890" in JSON
10. **Equity chart fix** â€” Unified Account was double-counting spot USDC
11. **Auto-plan injection** â€” Debate engine writes hourly-plan.json, trader reads it directly
12. **Prompt reduction** â€” System prompt 12Kâ†’3.8K chars (68% reduction)
13. **Preprocessed data** â€” Raw kline tables replaced with interpreted signals
14. **Cron updated** â€” No longer overwrites plan, only writes teaching notes
15. **Port mapping fixed** â€” 8090â†’8080

### Design Decisions
- **Arena debates for strategy, Fao for execution** â€” clean separation
- **hourly-plan.json** = single source of truth for trader plan
- **hourly-instruction.md** = Opus teaching notes, refreshed hourly
- **User wants preprocessed data** for both trader AND arena â€” remember this for future arena data work
- **BTC only for now** â€” will add multi-coin screener when account grows past $200+
