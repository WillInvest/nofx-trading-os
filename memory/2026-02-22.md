
## 4:00-7:00 AM - Trading System Debug Session

### Problem Chain
1. **Spot balance not in available** → Fixed: added `spotUSDCBalance` to `availableBalance` in trader.go line 302
2. **Min position size blocking** → Default lowered to 10 USDT (was 12)
3. **Agent wallet not authorized** → Private key derives to 0xeF0A... but main wallet is 0x3e96... MISMATCH!

### Root Cause
The private key configured for Fao generates a different address than the main Hyperliquid wallet. User needs to provide correct private key for 0x3e96 OR authorize 0xeF0A as an agent wallet.

### Code Changes (not committed)
- `trader/hyperliquid/trader.go`: availableBalance += spotUSDCBalance, bypassed agent wallet mode
- Agent wallet security check disabled

### Trading Brain
- 4 consecutive open_long signals (2AM, 4AM, 5AM, 6AM, 7AM)
- ETH: $1972 → $1980 (drifting toward TP $2020)
- All blocked by wallet auth issue

## Session: Feb 22, 2026 ~8:00-9:38 AM EST — Major Trading System Overhaul

### Wallet Fix
- Fixed HL agent wallet: `0x6F49d4C2C32ACA69c57f561861E2ee7f736b6d1A` authorized for main wallet `0x3e96`
- Private key `0xca3a...f2` encrypted in DB, derives correctly to `0x6F49`
- First trade executed: open_long ETH 0.0076 @ $1965.20
- Previous keys (`0xa0fe...`) derived to wrong addresses (`0x8ad6`, not `0xab31` or `0x3e96`)

### 15-Min Trading Cycle Pipeline
- `trading-cron.sh` → collects data, builds `brain-prompt.md`
- MiniMax analyzes (cron every 15 min, ID `bb0840b6`)
- `execute-decision.sh` → pushes to NOFX, copies cycle data to `nofx/data/arena/cycle-YYYY-MM-DDTHH-MM/`
- Cycle data: node-data.json, price-data.json, market-data.json, news-data.json, analysis.json, trading-plan.json, execution-result.json, cycle-summary.json
- `cycles-history.json` accumulates all cycles (last 100)

### Trading Rules Updated (anti-bias)
- Added `no_trade` and `hold` as valid strategies
- Require 2+ confirming signals for directional trades
- Stale on-chain (>4h) → max confidence 40%, prefer no_trade
- Price below daily SMA 20 + bearish EMA → bias short or no_trade
- Do NOT treat Extreme Fear as automatically bullish
- Require `confirming_signals` and `opposing_signals` in output

### Frontend Changes
- Added Price, ETH Node, News pages to App.tsx routing + HeaderBar nav
- Removed separate Dashboard tab (using Trader tab instead)
- Brain Cycles section added to TraderDashboardPage — shows cycle cards, expandable with Data/Analysis/Plan/Execution tabs
- Fixed blank screen: missing `useSWR` import
- Fixed crash on cycle click: `.toFixed()` on string values (null guards)
- ETH Node API endpoint fixed: serves `debate-context.json` (has `shared_intelligence`) not `eth-brief.json`
- Skipped `tsc` in build (vite only) to avoid pre-existing type errors

### Go Backend Endpoints Added
- `GET /api/arena/context` — on-chain/protocol data from debate-context.json
- `GET /api/arena/news` — news summary
- `GET /api/arena/cycles` — cycle history
- `GET /api/arena/cycle/:id` — full cycle data

### Continuous Data Feeds (system crontab)
- `market-collector-live.py` — daemon every 30s (nohup)
- On-chain from ETH node — crontab `*/5 * * * *`
- Full on-chain — crontab `0 * * * *`
- Merge all sources — crontab `*/2 * * * *` (merge-live.py)
- News scraper — crontab `0,30 * * * *`
- merge-live.py updated to copy raw files to Docker arena dir

### Results
- First cycle with new rules (9:15): `no_trade` — correctly identified bearish structure
- Second cycle (9:30): `no_trade` with FRESH on-chain data confirming bearish (whale outflows, stablecoin selling)
- Previously: 6 consecutive `open_long` into a dropping market. New rules fixed this.

### Key Lessons
- Always add `useSWR` import when using it (MiniMax forgot)
- Always null-guard `.toFixed()` — `(value ?? 'N/A').toFixed()` crashes
- Always build+deploy BEFORE reporting to user
- Execute-decision.sh must copy cycle dirs to `nofx/data/arena/` for Go backend to serve them
- Equity curve "jump" was caused by wallet key fix revealing $5 in perp, not a calculation bug

### User Preferences (this session)
- Show all times in Eastern Time
- Wants to see MiniMax analysis chain-of-thought in Trader tab
- No separate Dashboard tab needed
- Build and deploy before reporting
